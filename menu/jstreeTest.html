<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>jsTree í´ë” + ë…¸ë“œ ìƒ˜í”Œ</title>
    <!-- jsTree CSS -->
    <link href="/wsrv/app/css/plugin/jstree/default/style.min.css" rel="stylesheet" type="text/css" />

    <link rel="stylesheet" href="/wsrv/app/css/plugin/jquery.toast.css">
    <link href="/wsrv/app/js/plugins/mCustomScrollbar/jquery.mCustomScrollbar.css" rel="stylesheet" />
    <link href="/css/style.css?v=20211227_v1" rel="stylesheet" type="text/css" />

    
    <script type="text/javascript" src="/wsrv/app/js/jquery.min.js"></script>
    <script type="text/javascript" src="/wsrv/app/js/jquery-ui.min.js"></script>
    <script type="text/javascript" src="/wsrv/app/js/plugins/moment/moment.min.js"></script>
    <script type="text/javascript" src="/wsrv/app/js/plugins/toast/jquery.toast.min.js"></script>
    <script type="text/javascript" src="/wsrv/app/js/plugins/mCustomScrollbar/jquery.mCustomScrollbar.concat.min.js"></script>
    <script type="text/javascript" src="/wsrv/app/js/plugins/owl/owl.carousel.min.js" charset="utf-8"></script>
    <script type="text/javascript" src="/wsrv/app/js/iframeResizer.js"></script>
    <script type="text/javascript" src="/wsrv/app/js/plugins/jstree/jstree.min.js"></script>
    <script type="text/javascript" src="/wsrv/app/js/plugins/fuse/fuse.min.js"></script>
    <script type="text/javascript" src="/wsrv/app/js/plugins/handlebars/handlebars-v4.7.6.js"></script>
    <script type="text/javascript" src="/wsrv/app/js/pub.ep.js?version=51697.13478146136"></script>
    <script type="text/javascript" src="/wsrv/app/js/pub.ep.ui.js"></script>

    <style>
      body {
        font-family: sans-serif;
        margin: 30px;
      }
      #jstree {
        margin-top: 20px;
      }
    </style>
  </head>
  <body>
    <h2>ğŸ“ jsTree í´ë” + ë…¸ë“œ ìƒ˜í”Œ</h2>

    <button onclick="createFolder()">ìƒˆ í´ë” ë§Œë“¤ê¸°</button>
    <button onclick="addNewFolderAndNode()">ìƒˆ í´ë” & ë…¸ë“œ ì¶”ê°€</button>

    <!-- íŠ¸ë¦¬ê°€ í‘œì‹œë  ìš”ì†Œ -->
    <div id="jstree"></div>

    <script>
      const MAX_TOP_LEVEL_NODES = 10;
      const MAX_CHILD_NODES = 5;
      // íŠ¸ë¦¬ ì´ˆê¸°í™”
      var jstreeObj = $("#jstree").jstree({
        core: {
          // ë…¸ë“œ ìƒì„±/ì´ë™ì„ í—ˆìš©
          check_callback: function (op, node, parent, position, more) {
            console.log("parent : ", node, parent);

            if (op == "create_node") {
              if (parent.id === "#") {
                if (parent.children.length >= MAX_TOP_LEVEL_NODES) {
                  PubEPUI.toast.view({text:`ìµœìƒìœ„ ë…¸ë“œëŠ” ìµœëŒ€ ${MAX_TOP_LEVEL_NODES}ê°œê¹Œì§€ë§Œ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!`})
                  
                  return false;
                } else {
                  return true; // ìµœìƒìœ„ ë…¸ë“œëŠ” ì œí•œ ì—†ìŒ
                }
              }

              if (parent.children.length >= MAX_CHILD_NODES) {
                PubEPUI.toast.view({text:`í•˜ìœ„ ë…¸ë“œëŠ” ìµœëŒ€ ${MAX_CHILD_NODES}ê°œê¹Œì§€ë§Œ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!`})
                
                return false;
              }
              return true;
            }

            if (op == "move_node") {
              if (node.parent === parent.id) {
                return true;
              } else {
                return false;
              }
            }
          },
          data: [
            {
              id: "folder_1",
              text: "í´ë” 1",
              type: "default",
              children: [
                { id: "node_1", text: "ë…¸ë“œ 1", type: "file" },
                { id: "node_2", text: "ë…¸ë“œ 2", type: "file" },
              ],
            },
            {
              id: "folder_2",
              text: "í´ë” 2",
              type: "default",
              children: [{ id: "node_3", text: "ë…¸ë“œ 3", type: "file" }],
            },
          ],
        },
        plugins: ["types", "dnd", "contextmenu"],
        types: {
          "#": {
            max_depth: 2, // ìµœëŒ€ ê¹Šì´ ì„¤ì •
          }
        },
      });

      var treeObj = jstreeObj.jstree();

      function addNewFolderAndNode() {
        // ì´ë¯¸ "ìƒˆ í´ë”"ê°€ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸
        if (treeObj.get_node("new_folder")) {
          
          PubEPUI.toast.view({text:"ìƒˆ í´ë”ê°€ ì´ë¯¸ ì¡´ì¬í•©ë‹ˆë‹¤!"})
          return;
        }

        // ìƒˆ í´ë” ì¶”ê°€
        var folderNode = treeObj.create_node(
          null,
          {
            id: "new_folder",
            text: "ìƒˆ í´ë”",
            type: "default",
          },
          "last"
        );

        // í´ë”ê°€ ì œëŒ€ë¡œ ë§Œë“¤ì–´ì¡Œë‹¤ë©´ ìì‹ ë…¸ë“œ ì¶”ê°€
        if (folderNode) {
          for (var i = 0; i < 6; i++) {
            // 10ë²ˆ ì‹œë„í•´ë„ ìµœëŒ€ 5ê°œê¹Œì§€ë§Œ ìƒì„±ë¨
            treeObj.create_node(folderNode, {
              id: "child_" + (i + 1),
              text: "ìì‹ ë…¸ë“œ " + (i + 1),
            });
          }

          // í´ë” í¼ì¹˜ê¸°
          treeObj.open_node(folderNode);
        }
      }
      var idx = 0;
      function createFolder() {
        idx++;
        // ìƒˆ í´ë” ì¶”ê°€
        var folderNode = treeObj.create_node(
          null,
          {
            id: "new_folder" + idx,
            text: "ìƒˆ í´ë”" + idx,
            type: "default",
          },
          "last"
        );
      }
    </script>
  </body>
</html>
